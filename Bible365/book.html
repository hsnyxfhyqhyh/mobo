<!DOCTYPE>
<html>
    <head> 
        <meta name="viewport" content="width=device-width" />
        <meta charset="UTF-8" >
		<META http-equiv=Content-Type content="text/html; charset=gb2312">
       
        <script type="text/javascript" src="js/jquery-1.11.1.min.js"></script>
        <link rel="stylesheet" href="css/jquery.mobile-1.4.5.min.css">
        
        <script type="text/javascript" src="js/jquery.mobile-1.4.5.min.js"></script>
        
        <script>   
			function getParameterByName(name, url) {
				if (!url) url = window.location.href;
				name = name.replace(/[\[\]]/g, '\\$&');
				var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
					results = regex.exec(url);
				if (!results) return null;
				if (!results[2]) return '';
				return decodeURIComponent(results[2].replace(/\+/g, ' '));
			}

			
			var bookNumber = getParameterByName('bookNumber'); 
			var chapterNumber = getParameterByName('chapterNumber'); 
			var m = getParameterByName('m');
			var chapterCount;

			//handle the parameter passed in - bookNumber 
			if (bookNumber == null){
				bookNumber= "01";
			}

			//handle the parameter passed in -chapterNumber
			if (chapterNumber == null){
				chapterNumber=1;
			}
			
			//handle the parameter passed in - version
			if (m == null || m == 'c'){
				version="hhb";
			} else if (m= "e") {
				version= "niv"
			} 

			var bookPathUrl = "https://s3.amazonaws.com/bible365/json/" + bookNumber + ".json"; 
			var titleName;
			var book ;

			$( document ).ready(function() {
				$.getJSON(bookPathUrl, function(data){
					book = data;
					reload();

				});
			});
			
			function reload() {
				//alert (chapterNumber);
				var chapter = book.Chapters[chapterNumber-1];

				if (version == 'hhb') { titleName = chapter.BookName }
    			else if (version = 'niv') {titleName = chapter.BookName_En}
				
				chapterCount = parseInt(book["ChapterCount"]);
				var verseVersion ;

				for (i in chapter.Versions) {
					v = chapter.Versions[i];

					if (version == v.VersionName)  {
						verseVersion = v;
					}
				}

				 //set header content
				document.getElementById("header1").innerHTML = 
					"<h1 class='ui-title' role='heading' aria-level='1'><font style='white-space:normal;font-family:SimHei;font-size: large' >" + titleName 
					+ " - " + chapter.ChapterNumber + "</font></h1>";

				//set the content section
				c = "<ol data-role='listview' class='ui-listview'>"
				for (j in verseVersion.Verses) {
					c += "<li class='ui-li-static ui-body-inherit ui-first-child'><font style='white-space:normal;font-family:SimSun;  font-size: medium' >" 
							+ verseVersion.Verses[j].VerseContent 
						  + "</font></li>"
				}

				c += "</ol>"

				document.getElementById("content").innerHTML = c;
			}
			
						
// 			$.getJSON("json/Book.json", function(data){
// 				alert(data["BookName"]);
	
// 			});

// 			$.getJSON("https://lmncw4mlel.execute-api.us-east-1.amazonaws.com/prod/bible-init-2?username=livingwater&lastname=hu3", function(data){
// 				alert(data["statusCode"]);
	
// 			});

			function navPrevious(){
				if (chapterNumber > 1){
				   chapterNumber = parseInt(chapterNumber) -1;
				   reload();
				} else if (chapterNumber ==1) {
					if (bookNumber != "01") {
						var b;
						if (bookNumber.startsWith("0")){
							b = parseInt(bookNumber.substring(1, 2));
						} else {
							b=parseInt(bookNumber);
						}

						b = b-1;

						if (b<10) {
							bookNumber = "0" + b;
						} else {
							bookNumber = "" + b;
						}
						
						bookPathUrl = "https://s3.amazonaws.com/bible365/json/" + bookNumber + ".json"; 
						
						$.getJSON(bookPathUrl, function(data){
// 							alert("inside json call back");
							book = data;
							chapterNumber = parseInt(book["ChapterCount"]);
							reload();

						});
					}
				}

			}


			function navNext(){
				
				if (chapterNumber < chapterCount){
				   chapterNumber = parseInt(chapterNumber) + 1;
				   reload();
				} else {

					if (bookNumber != "66") {

						var b;
						if (bookNumber.startsWith("0")){
							b = parseInt(bookNumber.substring(1, 2));
						} else {
							b=parseInt(bookNumber);
						}
						b = b+1;

						if (b<10) {
							bookNumber = "0" + b;
						} else {
							bookNumber = "" + b;
						}
						
						bookPathUrl = "https://s3.amazonaws.com/bible365/json/" + bookNumber + ".json"; 
						
						$.getJSON(bookPathUrl, function(data){
// 							alert("inside json call back");
							book = data;
							chapterNumber = 1;
							reload();

						});
					}
				}
			}
        </script>

		

        
    </head>
    <body>
    <div data-role="page" id="page" >
            <div data-role="header" id="header1">
                <h1>B 365 </h1>
            </div>
            <div data-role="content" id="content">
                <ol data-role="listview" >
                    <li>Loading</li>
                  
                </ol>
            </div>

            <div data-role="footer" data-position="fixed" id="footer1">
                <a href="#" class="ui-btn ui-icon-arrow-l ui-btn-icon-notext" onclick="navPrevious();" >Left</a>
                <a href="#" class="ui-btn ui-icon-arrow-r ui-btn-right ui-btn-icon-notext" onclick="navNext();" >Left</a>
                
            </div>          
 			
        </div>
      
    </body>
</html>